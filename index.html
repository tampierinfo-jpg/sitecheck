<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SiteCheck ‚Äì Ampel</title>
<style>
  :root{
    --bg:#f4f4f9;
    --card:#fff;
    --text:#23262a;
    --muted:#667085;
    --ok:#16a34a;
    --warn:#f59e0b;
    --bad:#dc2626;
    --soft:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    background:var(--bg); color:var(--text); line-height:1.45;
  }
  .wrap{
    max-width: 720px; margin: 48px auto; background:var(--card);
    padding: 24px; border-radius: 16px; box-shadow:0 10px 30px rgba(0,0,0,.06);
  }
  h1{margin:0 0 10px; font-size: clamp(22px, 4vw, 34px); text-align:center;}
  .lead{margin:0 0 18px; color:var(--muted); text-align:center; font-size:clamp(14px,2.6vw,18px)}

  .row{display:flex; gap:10px; margin:10px 0}
  input, textarea{
    width:100%; font-size:18px; padding:14px 16px; border-radius:12px;
    border:1px solid var(--soft); outline:none;
  }
  input::placeholder, textarea::placeholder{color:#9aa3af}
  button{
    white-space:nowrap; padding:14px 18px; border:none; border-radius:12px;
    background:#2563eb; color:#fff; font-size:18px; cursor:pointer;
  }
  button:hover{filter:brightness(.96)}
  .result{
    margin-top:16px; padding:14px; border-radius:12px; font-size:16px;
  }
  .ok   { background:#dcfce7; color:#14532d; }
  .warn { background:#fef9c3; color:#7a5600; }
  .bad  { background:#fee2e2; color:#7f1d1d; }
  .hint{margin:6px 0 0; font-size:13px; color:#6b7280; text-align:center}

  /* Feste Mini-Ampel oben links (Badge) */
  .badge{
    position:fixed; top:12px; left:12px; z-index:9999;
    display:flex; gap:8px; align-items:center; padding:8px 10px;
    background:rgba(255,255,255,.92); backdrop-filter: blur(6px);
    border:1px solid var(--soft); border-radius:999px; box-shadow:0 6px 18px rgba(0,0,0,.08);
    transition: transform .2s ease;
  }
  .dot{
    width:14px; height:14px; border-radius:50%; background:#d1d5db; /* grau = inaktiv */
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
  }
  .dot.red.active    { background:var(--bad) }
  .dot.yellow.active { background:var(--warn) }
  .dot.green.active  { background:var(--ok)  }
  .badge label{
    font-size:13px; color:#475569; user-select:none; display:none;
  }
  @media (min-width:600px){ .badge label{display:inline} }

  /* üî• Extra 1: Shake bei Rot */
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20%,60% { transform: translateX(-6px); }
    40%,80% { transform: translateX(6px); }
  }
  .badge.danger { animation: shake .45s ease-in-out; }

  /* üéâ Extra 3: sanftes Gr√ºn-Gl√ºhen */
  @keyframes glow {
    0% { box-shadow: 0 0 0px rgba(22,163,74,0.9); }
    100% { box-shadow: 0 0 18px rgba(22,163,74,0); }
  }
  .dot.green.active { animation: glow 1.2s ease-out; }
</style>
</head>
<body>

<!-- Badge-Ampel -->
<div class="badge" id="badge" title="Status der letzten Pr√ºfung. Tippen, um zum Eingabefeld zu springen.">
  <div class="dot red"   id="b-red"></div>
  <div class="dot yellow" id="b-yellow"></div>
  <div class="dot green"  id="b-green"></div>
  <label id="badgeLabel">Bereit</label>
</div>

<div class="wrap">
  <h1>SiteCheck ‚Äì Ampel</h1>
  <p class="lead">Gib eine URL ein (z. B. <code>https://sparkasse.de</code>) und klicke auf ‚ÄûPr√ºfen‚Äú.</p>

  <div class="row">
    <input id="single" placeholder="https://beispiel.de/login" inputmode="url" />
    <button id="btn">Pr√ºfen</button>
  </div>

  <div id="out" class="result" style="display:none"></div>
  <!-- üö´ Extra 2: roter STOPP-Hinweis -->
  <p id="alert" style="display:none; margin-top:8px; font-size:18px; font-weight:bold; color:#dc2626; text-align:center;">
    ‚ö†Ô∏è STOPP! Diese Seite ist gef√§hrlich.
  </p>

  <p class="hint">Tipp: Du kannst diese Seite auch mit <code>?u=https://‚Ä¶</code> aufrufen. Die Ampel pr√ºft sofort.</p>
</div>

<script>
/* ---------- Daten ---------- */
const SAFE = [
  "sparkasse.de"
];
const BLACKLIST = [
  "sparkassse.de", "sparkasssse.de", "sparkassse.com",
  "paypa1.com", "secure-paypal-login.com", "bank-login-verification.xyz",
  "amaz0n-support.net", "amaz0n-konto.net", "paypal-kundencenter.xyz",
  "dhl-paket-verfolgung.top"
];

/* ---------- Helpers ---------- */
function setBadge(status, labelText){
  const badge = document.getElementById("badge");
  badge.classList.remove("danger");

  const map = { bad:"b-red", warn:"b-yellow", ok:"b-green" };
  ["b-red","b-yellow","b-green"].forEach(id=>document.getElementById(id).classList.remove("active"));
  document.getElementById(map[status]).classList.add("active");

  const label = document.getElementById("badgeLabel");
  label.textContent = labelText || (status==="ok" ? "Unauff√§llig" : status==="warn" ? "Vorsicht" : "Gef√§hrlich");

  if(status==="bad"){
    badge.classList.add("danger"); // üî• shake bei Rot
  }
}

function normalizeUrl(raw){
  if(!raw) return null;
  let s = raw.trim();
  if(!/^https?:\/\//i.test(s)) s = "https://" + s;
  try{ return new URL(s); }catch{ return null; }
}
function endsWithHost(host, candidate){
  return host === candidate || host.endsWith("."+candidate);
}
function levenshtein(a,b){
  if(a===b) return 0;
  const m=a.length, n=b.length;
  const dp = Array.from({length:m+1}, ()=>Array(n+1).fill(0));
  for(let i=0;i<=m;i++) dp[i][0]=i;
  for(let j=0;j<=n;j++) dp[0][j]=j;
  for(let i=1;i<=m;i++){
    for(let j=1;j<=n;j++){
      const c = a[i-1]===b[j-1]?0:1;
      dp[i][j] = Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+c);
    }
  }
  return dp[m][n];
}

/* ---------- Bewertung ---------- */
function score(u){
  const url = normalizeUrl(u);
  if(!url) return { lamp:"warn", title:"Ung√ºltige URL", msg:"Bitte gib eine g√ºltige URL ein.", detail:String(u) };

  const host = url.hostname.toLowerCase();

  // 1) Blacklist
  if(BLACKLIST.some(b=>endsWithHost(host, b)))
    return { lamp:"bad", title:"Gef√§hrlich (Blacklist)", msg:"Domain steht auf der Sperrliste.", detail:host };

  // 2) Safelist
  if(SAFE.some(s=>endsWithHost(host, s))){
    if(url.protocol==="http:")
      return { lamp:"warn", title:"Nur HTTP", msg:"Verbindung ist nicht verschl√ºsselt (HTTP).", detail:url.href };
    return { lamp:"ok", title:"Unauff√§llig (bekannte Domain)", msg:"Kein Treffer in Blacklist.", detail:host };
  }

  // 3) Lookalike-Check (gegen wichtige Marken)
  const important = ["sparkasse.de","paypal.com","amazon.de","dhl.de","icloud.com"];
  for(const base of important){
    const d = levenshtein(host, base);
    if(d>0 && d<=2) return { lamp:"bad", title:"Gef√§hrlich (Lookalike)", msg:`Sieht aus wie ‚Äû${base}‚Äú.`, detail:host };
  }

  // 4) HTTP ohne TLS
  if(url.protocol==="http:")
    return { lamp:"warn", title:"Nur HTTP", msg:"Verbindung ist nicht verschl√ºsselt (HTTP).", detail:url.href };

  // 5) Neutral
  return { lamp:"ok", title:"Unauff√§llig", msg:"Keine Auff√§lligkeiten gefunden.", detail:host };
}

/* ---------- UI ---------- */
const inp   = document.getElementById("single");
const btn   = document.getElementById("btn");
const out   = document.getElementById("out");
const alertBox = document.getElementById("alert");

function render(res){
  out.style.display = "block";
  const cls = res.lamp==="bad" ? "bad" : res.lamp==="warn" ? "warn" : "ok";
  out.className = "result " + cls;
  out.innerHTML = `<strong>${res.title}</strong><br>${res.msg}<br><small>${res.detail}</small>`;
  setBadge(res.lamp, res.title);

  // üö´ Extra 2: STOPP-Hinweis
  alertBox.style.display = (res.lamp==="bad") ? "block" : "none";
}

btn.onclick = ()=>{
  const res = score(inp.value);
  render(res);
};

document.getElementById("badge").onclick = ()=>{
  inp.scrollIntoView({behavior:"smooth", block:"center"});
  inp.focus();
};

/* ---------- Autostart √ºber ?u= ---------- */
(function autostart(){
  const u = new URLSearchParams(location.search).get("u");
  if(u){
    inp.value = u;
    const res = score(u);
    render(res); // sofort Ampel + Ergebnis
  }else{
    setBadge("ok","Bereit");
  }
})();
</script>
</body>
</html>
